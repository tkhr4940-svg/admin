
<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>çƒæŠ€å¤§ä¼šãƒ‡ãƒ¼ã‚¿ç·¨é›†ï¼ˆç®¡ç†ï¼‰</title>
<style>
  body{font-family:system-ui,-apple-system,"Noto Sans JP",sans-serif; margin:20px;}
  fieldset{margin-bottom:16px; border:1px solid #ccc; border-radius:8px;}
  legend{font-weight:700;}
  textarea,input{width:100%;}
  .row{display:grid; grid-template-columns: 1fr 1fr; gap:10px;}
  .row3{display:grid; grid-template-columns: 1fr 1fr 1fr; gap:10px;}
  .list{border:1px solid #ddd; border-radius:8px; padding:10px; margin:10px 0;}
  button{padding:8px 12px; border-radius:8px; margin-right:8px;}
  .muted{color:#666; font-size:.9rem;}
</style>
</head>
<body>
<h1>çƒæŠ€å¤§ä¼šãƒ‡ãƒ¼ã‚¿ç·¨é›†ï¼ˆJSONç®¡ç†ï¼‰</h1>

<div>
  <button id="btnLoad">ã‚µãƒ¼ãƒã® data.json ã‚’èª­ã¿è¾¼ã¿</button>
  <input type="file" id="fileLocal" accept="application/json">
  <button id="btnDownload">JSONã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
</div>
<p class="muted">â€» å…¬é–‹ã‚µãƒ¼ãƒã® data.json ã‚’å·®ã—æ›¿ãˆã‚‹ã¨æœ¬ç•ªã«åæ˜ ã•ã‚Œã¾ã™ã€‚</p>

<form id="form">
  <fieldset>
    <legend>åŸºæœ¬æƒ…å ±</legend>
    <div class="row">
      <div><label>å­¦æ ¡å<input id="schoolName"></label></div>
      <div><label>ã‚¤ãƒ™ãƒ³ãƒˆå<input id="eventName"></label></div>
    </div>
    <div><label>ã‚¿ã‚°ãƒ©ã‚¤ãƒ³ï¼ˆä¸Šéƒ¨ã®å°è¦‹å‡ºã—ï¼‰<input id="tagline"></label></div>
    <div><label>ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆHTMLå¯ï¼‰<textarea id="heroTitleHTML" rows="2"></textarea></label></div>
    <div><label>ãƒ’ãƒ¼ãƒ­ãƒ¼ã‚µãƒ–ï¼ˆHTMLå¯ï¼‰<textarea id="heroSubHTML" rows="3"></textarea></label></div>
    <div><label>ãƒ•ãƒƒã‚¿ãƒ¼å­¦æ ¡å<input id="footerSchool"></label></div>
  </fieldset>

  <fieldset>
    <legend>è‰²è¨­å®š</legend>
    <div class="row3">
      <div><label>ãƒã‚¤ãƒ“ãƒ¼<input id="colorNavy" type="color" value="#0C2340"></label></div>
      <div><label>ã‚´ãƒ¼ãƒ«ãƒ‰<input id="colorGold" type="color" value="#FFD84D"></label></div>
      <div><label>ãƒ–ãƒ«ãƒ¼<input id="colorBlue" type="color" value="#43C1F2"></label></div>
    </div>
  </fieldset>

  <fieldset>
    <legend>ãŠçŸ¥ã‚‰ã› <button type="button" id="addNotice">ï¼‹è¿½åŠ </button></legend>
    <div id="noticeWrap"></div>
  </fieldset>

  <fieldset>
    <legend>ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« <button type="button" id="addRow">ï¼‹è¡Œè¿½åŠ </button></legend>
    <div id="scheduleWrap"></div>
  </fieldset>

  <fieldset>
    <legend>ç«¶æŠ€ <button type="button" id="addSport">ï¼‹è¿½åŠ </button></legend>
    <div id="sportsWrap"></div>
  </fieldset>

  <fieldset>
    <legend>ã‚¢ã‚¯ã‚»ã‚¹</legend>
    <div><label>åœ°å›³HTMLï¼ˆiframeå¯ï¼‰<textarea id="mapHTML" rows="3"></textarea></label></div>
    <div class="list">
      <strong>ãƒªã‚¹ãƒˆé …ç›®</strong>ï¼ˆä¼šå ´ï¼æŒã¡ç‰©ï¼æœè£…ï¼æ³¨æ„ ãªã©ï¼‰
      <button type="button" id="addAccess">ï¼‹é …ç›®è¿½åŠ </button>
      <div id="accessItems"></div>
    </div>
    <div><label>æ‹…å½“ï¼ˆHTMLå¯ï¼‰<input id="deptHTML"></label></div>
    <div><label>ä»£è¡¨ãƒ¡ãƒ¼ãƒ«ï¼ˆHTMLå¯ï¼‰<input id="contactHTML"></label></div>
  </fieldset>
</form>

<script>
let model = {
  meta:{schoolName:'',eventName:'',tagline:'',heroTitleHTML:'',heroSubHTML:'',footerSchool:''},
  colors:{navy:'#0C2340',gold:'#FFD84D',blue:'#43C1F2'},
  notices:[], schedule:[], sports:[],
  access:{mapHTML:'',itemsHTML:[],deptHTML:'',contactHTML:''},
  animation:{ballCount:14,sizeMin:24,sizeMax:96,speedMin:16,speedMax:42,bobMin:8,bobMax:26}
};

const $ = sel => document.querySelector(sel);
const wrapNotice = $('#noticeWrap');
const wrapSchedule = $('#scheduleWrap');
const wrapSports = $('#sportsWrap');
const wrapAccess = $('#accessItems');

function render(){
  // åŸºæœ¬
  $('#schoolName').value = model.meta.schoolName||'';
  $('#eventName').value = model.meta.eventName||'';
  $('#tagline').value = model.meta.tagline||'';
  $('#heroTitleHTML').value = model.meta.heroTitleHTML||'';
  $('#heroSubHTML').value = model.meta.heroSubHTML||'';
  $('#footerSchool').value = model.meta.footerSchool||'';
  $('#colorNavy').value = toHex(model.colors.navy,'#0C2340');
  $('#colorGold').value = toHex(model.colors.gold,'#FFD84D');
  $('#colorBlue').value = toHex(model.colors.blue,'#43C1F2');

  // ãŠçŸ¥ã‚‰ã›
  wrapNotice.innerHTML = '';
  model.notices.forEach((n,i)=>{
    const div = document.createElement('div');
    div.className='list';
    div.innerHTML = `
      <div class="row">
        <div><label>ãƒãƒƒã‚¸<input data-k="badge" data-i="${i}" value="${esc(n.badge)}"></label></div>
        <div><label>æ—¥ä»˜è¡¨ç¤º<input data-k="dateText" data-i="${i}" value="${esc(n.dateText||'')}"></label></div>
      </div>
      <div class="row">
        <div><label>datetime(ISO)<input data-k="datetime" data-i="${i}" value="${esc(n.datetime||'')}"></label></div>
        <div><button type="button" data-del="notice" data-i="${i}">å‰Šé™¤</button></div>
      </div>
      <div><label>ã‚¿ã‚¤ãƒˆãƒ«ï¼ˆHTMLï¼‰<textarea data-k="titleHTML" data-i="${i}" rows="2">${esc(n.titleHTML||'')}</textarea></label></div>
      <div><label>æœ¬æ–‡ï¼ˆHTMLï¼‰<textarea data-k="bodyHTML" data-i="${i}" rows="2">${esc(n.bodyHTML||'')}</textarea></label></div>
    `;
    wrapNotice.appendChild(div);
  });

  // ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
  wrapSchedule.innerHTML = '';
  model.schedule.forEach((r,i)=>{
    const div = document.createElement('div');
    div.className='list';
    div.innerHTML = `
      <div class="row">
        <div><label>æ™‚é–“ï¼ˆHTMLï¼‰<input data-s="timeHTML" data-i="${i}" value="${esc(r.timeHTML||'')}"></label></div>
        <div><label>å ´æ‰€ï¼ˆHTMLï¼‰<input data-s="placeHTML" data-i="${i}" value="${esc(r.placeHTML||'')}"></label></div>
      </div>
      <div><label>å†…å®¹ï¼ˆHTMLï¼‰<input data-s="contentHTML" data-i="${i}" value="${esc(r.contentHTML||'')}"></label></div>
      <div><button type="button" data-del="schedule" data-i="${i}">å‰Šé™¤</button></div>
    `;
    wrapSchedule.appendChild(div);
  });

  // ç«¶æŠ€
  wrapSports.innerHTML = '';
  model.sports.forEach((s,i)=>{
    const div = document.createElement('div');
    div.className='list';
    div.innerHTML = `
      <div class="row">
        <div><label>çµµæ–‡å­—<input data-p="emoji" data-i="${i}" value="${esc(s.emoji||'ğŸ€')}"></label></div>
        <div><button type="button" data-del="sport" data-i="${i}">å‰Šé™¤</button></div>
      </div>
      <div><label>ç«¶æŠ€åï¼ˆHTMLï¼‰<input data-p="nameHTML" data-i="${i}" value="${esc(s.nameHTML||'')}"></label></div>
      <div><label>ä¼šå ´ï¼ˆHTMLï¼‰<input data-p="venueHTML" data-i="${i}" value="${esc(s.venueHTML||'')}"></label></div>
    `;
    wrapSports.appendChild(div);
  });

  // ã‚¢ã‚¯ã‚»ã‚¹
  wrapAccess.innerHTML='';
  (model.access.itemsHTML||[]).forEach((t,i)=>{
    const div=document.createElement('div');
    div.className='list';
    div.innerHTML=`
      <div class="row">
        <div><label>é …ç›®ï¼ˆHTMLï¼‰<input data-a="itemsHTML" data-i="${i}" value="${esc(t||'')}"></label></div>
        <div><button type="button" data-del="access" data-i="${i}">å‰Šé™¤</button></div>
      </div>`;
    wrapAccess.appendChild(div);
  });
  $('#mapHTML').value = model.access.mapHTML||'';
  $('#deptHTML').value = model.access.deptHTML||'';
  $('#contactHTML').value = model.access.contactHTML||'';
}

function esc(s){ return (s??'').replaceAll('&','&amp;').replaceAll('<','&lt;').replaceAll('>','&gt;').replaceAll('"','&quot;'); }
function toHex(v,fb){ return /^#([0-9A-Fa-f]{6})$/.test(v||'') ? v : fb; }

document.getElementById('addNotice').onclick = ()=>{ model.notices.push({badge:'INFO',titleHTML:'',dateText:'',datetime:'',bodyHTML:''}); render(); };
document.getElementById('addRow').onclick = ()=>{ model.schedule.push({timeHTML:'00:00',contentHTML:'å†…å®¹',placeHTML:'å ´æ‰€'}); render(); };
document.getElementById('addSport').onclick = ()=>{ model.sports.push({emoji:'ğŸ€',nameHTML:'æ–°ã—ã„ç«¶æŠ€',venueHTML:'ä¼šå ´'}); render(); };
document.getElementById('addAccess').onclick = ()=>{ model.access.itemsHTML.push(''); render(); };

// å…¥åŠ›å¤‰æ›´ã®åŒæ–¹å‘ãƒã‚¤ãƒ³ãƒ‰
document.body.addEventListener('input', e=>{
  const t=e.target;
  if(t.id==='schoolName') model.meta.schoolName=t.value;
  else if(t.id==='eventName') model.meta.eventName=t.value;
  else if(t.id==='tagline') model.meta.tagline=t.value;
  else if(t.id==='heroTitleHTML') model.meta.heroTitleHTML=t.value;
  else if(t.id==='heroSubHTML') model.meta.heroSubHTML=t.value;
  else if(t.id==='footerSchool') model.meta.footerSchool=t.value;
  else if(t.id==='colorNavy') model.colors.navy=t.value;
  else if(t.id==='colorGold') model.colors.gold=t.value;
  else if(t.id==='colorBlue') model.colors.blue=t.value;
  else if(t.dataset.k){ model.notices[t.dataset.i][t.dataset.k]=t.value; }
  else if(t.dataset.s){ model.schedule[t.dataset.i][t.dataset.s]=t.value; }
  else if(t.dataset.p){ model.sports[t.dataset.i][t.dataset.p]=t.value; }
  else if(t.id==='mapHTML') model.access.mapHTML=t.value;
  else if(t.id==='deptHTML') model.access.deptHTML=t.value;
  else if(t.id==='contactHTML') model.access.contactHTML=t.value;
  else if(t.dataset.a==='itemsHTML'){ model.access.itemsHTML[t.dataset.i]=t.value; }
});

document.body.addEventListener('click', e=>{
  const t=e.target;
  if(t.dataset.del==='notice'){ model.notices.splice(+t.dataset.i,1); render(); }
  if(t.dataset.del==='schedule'){ model.schedule.splice(+t.dataset.i,1); render(); }
  if(t.dataset.del==='sport'){ model.sports.splice(+t.dataset.i,1); render(); }
  if(t.dataset.del==='access'){ model.access.itemsHTML.splice(+t.dataset.i,1); render(); }
});

// data.json èª­è¾¼
document.getElementById('btnLoad').onclick = async ()=>{
  try{
    const res = await fetch('data.json', { cache: 'no-store' });
    if(!res.ok) throw new Error();
    model = await res.json(); render(); alert('data.json ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚');
  }catch(e){ alert('data.json ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸã€‚'); }
};
// ãƒ­ãƒ¼ã‚«ãƒ«JSONèª­è¾¼
document.getElementById('fileLocal').onchange = e=>{
  const f=e.target.files[0]; if(!f) return;
  const r=new FileReader();
  r.onload = ()=>{ try{ model=JSON.parse(r.result); render(); alert('ãƒ­ãƒ¼ã‚«ãƒ«JSONã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸã€‚'); }catch(err){ alert('JSONå½¢å¼ãŒä¸æ­£ã§ã™ã€‚'); } };
  r.readAsText(f);
};
// JSONãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
document.getElementById('btnDownload').onclick = ()=>{
  const blob = new Blob([JSON.stringify(model, null, 2)],{type:'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download='data.json';
  document.body.appendChild(a); a.click(); a.remove(); URL.revokeObjectURL(url);
};

render();
</script>
</body>
</html>
